___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Super Consent Tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Consent Mode Template for Google",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "call",
    "displayName": "Consent Call",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "default",
        "displayValue": "Default"
      },
      {
        "value": "update",
        "displayValue": "Update"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": false
  },
  {
    "type": "GROUP",
    "name": "flags",
    "displayName": "Consent Flags",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "ad_storage",
        "displayName": "ad_storage",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "notSetText": ""
      },
      {
        "type": "SELECT",
        "name": "analytics_storage",
        "displayName": "analytics_storage",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "notSetText": ""
      },
      {
        "type": "SELECT",
        "name": "ad_user_data",
        "displayName": "ad_user_data",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "notSetText": ""
      },
      {
        "type": "SELECT",
        "name": "ad_personalization",
        "displayName": "ad_personalization",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "notSetText": ""
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "wait_for_update",
    "displayName": "Wait for Update",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "wait_update",
        "checkboxText": "Wait for Update?",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "wait_update_time",
        "displayName": "wait for update time in ms",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NUMBER"
          },
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "call",
        "paramValue": "default",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "datalayer_push",
    "checkboxText": "Push Event to dataLayer?",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const set_default = require('setDefaultConsentState');
const set_update = require('updateConsentState');
const make_number = require('makeNumber');
const datalayer_push = require('createQueue')('dataLayer');

var api_call = data.call === "default" ? set_default : set_update;

var flags = {};
var granted_values = [
  "granted",
  1,
  "1",
  true,
  "true"
];

flags.ad_storage = (granted_values.indexOf(data.ad_storage) > -1) ? "granted" : "denied";
flags.analytics_storage = (granted_values.indexOf(data.analytics_storage) > -1) ? "granted" : "denied";
flags.ad_user_data = (granted_values.indexOf(data.ad_user_data) > -1) ? "granted" : "denied";
flags.ad_personalization = (granted_values.indexOf(data.ad_personalization) > -1) ? "granted" : "denied";

if (data.call === "default" && data.wait_update && make_number(data.wait_update_time) > 0) {
  flags.wait_for_update = make_number(data.wait_update_time);
}

api_call(flags);

if (data.datalayer_push) {
  flags.event = data.call + "_call";
  datalayer_push(flags);
} 

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: default test
  code: |-
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('setDefaultConsentState').wasCalledWith({
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'granted',
      ad_personalization: 'denied',
      wait_for_update: 500
    });
- name: update test
  code: |-
    mockData.call = "update";

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('updateConsentState').wasCalledWith({
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'granted',
      ad_personalization: 'denied'
    });
setup: |-
  const mockData = {
    call: 'default',
    ad_storage: undefined,
    analytics_storage: null,
    ad_user_data: 1,
    ad_personalization: 'denied',
    wait_update: true,
    wait_update_time: 500
  };


___NOTES___

Created on 6/13/2025, 11:58:57 AM


